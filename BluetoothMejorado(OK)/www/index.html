<!DOCTYPE html>
<html>

<head>
    <title>Prueba el bluetooth del dispositivo</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=no">

    <style>

        @-ms-viewport { width: 100vw ; min-zoom: 100% ; zoom: 100% ; }          @viewport { width: 100vw ; min-zoom: 100% zoom: 100% ; }
        @-ms-viewport { user-zoom: fixed ; min-zoom: 100% ; }                   @viewport { user-zoom: fixed ; min-zoom: 100% ; }

    </style>

    <link rel="stylesheet" href="css/app.css">
</head>


<body>
    <h1 class="align-center">Prueba de bluetooth</h1>
    <br>
    <p class="align-center">
        <button id="bt" style='width:100%; height:50px'>Activa bluetooth</button><br><br>
    </p>
    
    <br><br>
    <div id = "estado"></div>

    <script src="cordova.js"></script>          <!-- "Phantom" cordova.js required for projects that use plugins -->

    <script src="js/app.js"></script>           <!-- for your event code, see README and file comments for details -->
    <script src="js/init-app.js"></script>      <!-- for your init code, see README and file comments for details -->
    <script src="xdk/init-dev.js"></script>     <!-- normalizes device and document ready events, see file for details -->
    <script type="text/javascript">
        var bluetoothActivado; // su valor es true si está activado, false en caso contrario
        document.getElementById("bt").addEventListener("click", botonA);
        inicializaDisplay();

        function botonA(){
            //alert("voy a comprobar la conexión");
            compruebaConexionBluetooth();
        }
        
        function compruebaConexionBluetooth(){
            //alert("comprobando conexión...");
            bluetoothSerial.isEnabled(
                function() {
                    //alert("se va a apagar el bluetooth, estaba encendido");
                    console.log("Bluetooth is enabled");
                    document.getElementById("estado").innerHTML = "Bluetooth apagado";
                    bluetoothActivado = true;
                    activaBluetooth();
                },
                function() {
                    //alert("se va a encender el bluetooth, estaba apagado");
                    console.log("Bluetooth is *not* enabled");
                    document.getElementById("estado").innerHTML = "Bluetooth encendido";
                    bluetoothActivado = false;
                    activaBluetooth();
                }
            );  
        }
        
        function activaBluetooth(){
            if (bluetoothActivado == false) {
                //alert("intentando activar bluetooth");
                bluetoothSerial.enable(
                    function() {
                        console.log("Bluetooth is enabled");
                        bluetoothActivado = true;
                        alert("activado");
                    },
                    function() {
                        console.log("The user did *not* enable Bluetooth");
                        alert("error");
                    }
                );
            } else if (bluetoothActivado == true) {
                alert("El bluetooth ya está activado quizás quieres desactivarlo desde el menú de ajustes de tu teléfono");
                bluetoothSerial.showBluetoothSettings(); //no disponible en iOS
            } else {
                alert ("El comportamiento de la APP no es el esperado");
            }
        }
        
        function inicializaDisplay(){
            document.getElementById("estado").innerHTML = "¿?";

        }
    </script>
</body>

</html>
